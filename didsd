<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Złote Teksty Nauczycieli</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#e6f0ff; color:#003366; }
header { padding:20px; text-align:center; background:#003366; color:white; }
main { max-width:900px; margin:0 auto; padding:20px; }
.card { border:1px solid #003366; border-radius:12px; padding:16px; margin-bottom:16px; background:white; box-shadow:2px 2px 12px rgba(0,0,0,0.1); }
.list { list-style:none; padding-left:0; }
button { padding:10px 18px; border-radius:12px; border:none; cursor:pointer; background:#003366; color:white; font-weight:bold; transition: transform 0.2s; }
button:hover { transform: scale(1.05); }
.grid { display:grid; gap:16px; }
.two { grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
#countdown { font-size:3rem; text-align:center; margin:20px 0; color:#003366; font-weight:bold; }
.collapsible { background-color:#003366; color:white; cursor:pointer; padding:10px 18px; width:100%; border:none; text-align:left; outline:none; font-size:1.2rem; border-radius:12px; }
.active, .collapsible:hover { background-color:#0055aa; }
.content { padding:0 18px; display:none; overflow:hidden; background-color:#e6f0ff; border-radius:0 0 12px 12px; }
.footer { font-size:0.8rem; color:#003366; text-align:center; margin-top:40px; }

/* Przycisk admina w górnym prawym rogu */
#adminBtn {
  position: fixed;
  top: 10px;
  right: 10px;
  font-size:0.8rem;
  padding:6px 12px;
  opacity:0.5;
  border-radius:8px;
  z-index:1000;
}

/* Modal pełnoekranowy */
#adminModal {
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background: rgba(0,0,0,0.7);
  z-index:999;
  justify-content:center;
  align-items:center;
}
#adminModalContent {
  background:white;
  padding:20px;
  border-radius:12px;
  max-height:80%;
  max-width:90%;
  overflow-y:auto;
}
#adminModalContent table { width:100%; border-collapse:collapse; }
#adminModalContent th, #adminModalContent td { border:1px solid #003366; padding:8px; text-align:center; }
#closeAdmin { margin-top:10px; background:#0055aa; }
</style>
</head>
<body>
<header>
<h1>Złote Teksty Nauczycieli</h1>
</header>

<main>
<div id="countdown">Wyniki zostaną ogłoszone za: 00:00:00</div>

<section class="card" id="votingSection">
<button class="collapsible">Aktualne głosowanie</button>
<div class="content">
<div id="voteStatus"></div>
<button id="startVoting">Rozpocznij głosowanie</button>
<div id="votingBox" style="display:none;">
<form id="voteForm">
<ul class="list" id="quotesList"></ul>
<button type="submit" id="voteBtn">Głosuj</button>
</form>
<p id="voteMessage"></p>
</div>
</div>
</section>

<section class="card" id="historySection">
<button class="collapsible">Historia zwycięzców</button>
<div class="content">
<div id="history" class="grid two"></div>
</div>
</section>

<div class="footer">
W każdym semestrze z każdego roku szkolnego wybieramy cytat semestru, a na koniec roku wybieramy cytat całego roku szkolnego spośród dwóch zwycięskich cytatów semestralnych.
</div>

</main>

<!-- Przycisk admina -->
<button id="adminBtn">Admin</button>

<!-- Modal admina -->
<div id="adminModal">
  <div id="adminModalContent">
    <div id="adminResults"></div>
    <button id="closeAdmin">Zamknij</button>
  </div>
</div>

<script>
let votes = JSON.parse(localStorage.getItem('votes')||'{}');
let history = JSON.parse(localStorage.getItem('history')||'[]');
let voted = JSON.parse(localStorage.getItem('voted_once')||'false');

let quotes = [
'"Dupa" p. Lorczak',
'"nie, xD" p. Wypychowski',
'"Misiaczku, bejbe" p. Pajor',
'"Halo! Halo!" p. Pierko',
'"Popatrz w lustro" p. Makochon',
'"Genialne!" p. Kozioł '
];

const quotesList = document.getElementById('quotesList');
const voteStatus = document.getElementById('voteStatus');

function renderQuotesForVoting(){
quotesList.innerHTML='';
if(voted){
voteStatus.textContent='Dziękujemy za głos. Już zagłosowałeś.';
document.getElementById('startVoting').style.display='none';
document.getElementById('votingBox').style.display='none';
return;
} else {
voteStatus.textContent='';
document.getElementById('startVoting').style.display='inline';
}
quotes.forEach((q,idx)=>{
if(q && q.trim()!==''){
const li=document.createElement('li');
li.innerHTML='<label><input type="radio" name="quote" value="'+idx+'"> '+q+'</label>';
quotesList.appendChild(li);
}
});
}

function renderHistory(){
const box=document.getElementById('history');
box.innerHTML='';
if(!history || history.length===0){
const div=document.createElement('div');
div.className='card';
div.textContent='Tu nic nie ma';
box.appendChild(div);
return;
}
history.forEach(item=>{
const div=document.createElement('div');
div.className='card';
div.innerHTML='<strong>'+item.semestr+'</strong><br>'+item.cytat+'<br>głosy: '+item.glosy;
box.appendChild(div);
});
}

document.getElementById('startVoting').addEventListener('click',()=>{
document.getElementById('votingBox').style.display='block';
renderQuotesForVoting();
});

document.getElementById('voteForm').addEventListener('submit',e=>{
e.preventDefault();
const msg=document.getElementById('voteMessage');
const selected=document.querySelector('input[name="quote"]:checked');
if(!selected){ msg.textContent='Wybierz cytat przed oddaniem głosu.'; return; }
const id=selected.value;
votes[id]=(votes[id]||0)+1;
localStorage.setItem('votes',JSON.stringify(votes));
voted=true; localStorage.setItem('voted_once',JSON.stringify(voted));
msg.textContent='Dziękujemy za głos!';
renderQuotesForVoting();
});

// Zakładki
const coll = document.getElementsByClassName('collapsible');
for(let i=0;i<coll.length;i++){
coll[i].addEventListener('click', function(){
this.classList.toggle('active');
const content = this.nextElementSibling;
content.style.display = content.style.display === 'block' ? 'none' : 'block';
if(this.textContent.includes('Historia')) renderHistory();
if(this.textContent.includes('Aktualne')) renderQuotesForVoting();
});
}

// Odliczanie do 30 stycznia 16:00
function startCountdown(targetDate){
const countdownEl = document.getElementById('countdown');
const interval = setInterval(()=>{
const now = new Date().getTime();
const distance = targetDate - now;
if(distance<0){
countdownEl.textContent='Witajcie! Wyniki są już dostępne!';
clearInterval(interval);
return;
}
const days = Math.floor(distance/(1000*60*60*24));
const hours = Math.floor((distance % (1000*60*60*24))/(1000*60*60));
const minutes = Math.floor((distance % (1000*60*60))/(1000*60));
const seconds = Math.floor((distance % (1000*60))/1000);
countdownEl.textContent='Witajcie! Wyniki zostaną ogłoszone za: '+days+'d '+String(hours).padStart(2,'0')+':'+String(minutes).padStart(2,'0')+':'+String(seconds).padStart(2,'0');
},1000);
}

const today = new Date();
const target = new Date(today.getFullYear(), 0, 30, 16, 0, 0).getTime();
startCountdown(target);

renderQuotesForVoting();

// --- Panel admina na pełnym ekranie ---
const adminBtn = document.getElementById('adminBtn');
const adminModal = document.getElementById('adminModal');
const adminResultsDiv = document.getElementById('adminResults');
const closeAdmin = document.getElementById('closeAdmin');

adminBtn.addEventListener('click', ()=>{
    const pw = prompt("Podaj hasło admina:");
    if(pw !== "DH2rSp2") return alert("Niepoprawne hasło!");

    if(Object.keys(votes).length===0){
        adminResultsDiv.innerHTML='<p>Brak głosów.</p>';
    } else {
        let html='<table><tr><th>Cytat</th><th>Głosy</th></tr>';
        quotes.forEach((q,i)=>{
            const count = votes[i] || 0;
            html+='<tr><td>'+q+'</td><td>'+count+'</td></tr>';
        });
        html+='</table>';
        adminResultsDiv.innerHTML=html;
    }
    adminModal.style.display='flex';
});

closeAdmin.addEventListener('click', ()=>{
    adminModal.style.display='none';
});
</script>

</body>
</html>
